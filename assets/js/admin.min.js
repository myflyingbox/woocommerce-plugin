jQuery(function(e){var f={states:null,init:function(){e("#myflyingbox-order-shipping").on("click","button.add-shipment",this.add_shipment).on("click","div.mfb-available-offers button.book-offer",this.book_offer).on("click","div.display_recipient_address a.edit_recipient_address",this.load_recipient_form).on("click","div.display_shipper_address a.edit_shipper_address",this.load_shipper_form).on("click","div.parcel-data a.edit_parcel",this.load_parcel_form).on("click","div.parcel-data a.delete_parcel",this.delete_parcel).on("click","div.parcel-data button.new_parcel",this.load_parcel_form).on("click","div.recipient_form_container button.cancel_recipient_form",this.hide_recipient_form).on("click","div.shipper_form_container button.cancel_shipper_form",this.hide_shipper_form).on("click","div.parcel div.parcel-form button.cancel_parcel_form",this.hide_parcel_form).on("click","div.recipient_form_container button.submit_recipient_form",this.submit_recipient_form).on("click","div.shipper_form_container button.submit_shipper_form",this.submit_shipper_form).on("click","div.mfb-booked-offer button.download-labels",this.download_labels).on("click","div.parcel div.parcel-form button.submit_parcel_form",this.submit_parcel_form).on("change","div.mfb-available-offers select.offer-selector",this.update_selected_offer).on("click","a.delete-shipment",this.delete_shipment).on("click","button.add-return-shipment",this.add_return_shipment).on("click","div.mfb-booked-offer button.trackthis",this.trackthisExpedition).on("change","div.mfb-available-offers #mfb-admin-extended-cover-checkbox",this.update_extended_cover_offer),e("#myflyingbox-bulk-shipments").on("click","div.mfb-available-offers button.book-offer",this.book_offer).on("click","div.mfb-booked-offer button.download-labels",this.download_labels).on("change","div.mfb-available-offers select.offer-selector",this.update_selected_offer),e(".woocommerce-order-data #trackthis").length&&e(".woocommerce-order-data").on("click","#trackthis",this.trackthis)},add_shipment:function(){var t={action:"mfb_create_shipment",order_id:e(this).data("order_id")};return e.ajax({url:mfb_js_resources.ajax_url,data:t,type:"POST",success:function(i){window.location.reload()}}),!1},book_offer:function(){var t=e(this).closest("div.mfb-available-offers").find("select.offer-selector option:selected").data("offer_id"),i=e(this).closest("div.mfb-available-offers").find("select.pickup-date-selector"),a=e(this).closest("div.mfb-available-offers").find("select.delivery-location-selector"),r=e(this).closest("div.mfb-available-offers").find("input#mfb_ad_valorem_insurance"),s=e(this).closest("div.mfb-available-offers").find("input#mfb-admin-extended-cover-checkbox"),o="",d="",c="0",n="0";e(this).find(".spinner").addClass("is-active"),i&&(o=i.val()),a&&(d=a.val()),r.is(":checked")&&(c="1"),s.is(":checked")&&(n="1");var _={action:"mfb_book_offer",offer_id:t,pickup_date:o,relay_code:d,insurance:c,extended_cover:n,shipment_id:e(this).closest("tr").data("shipment_id")};return e.ajax({url:mfb_js_resources.ajax_url,data:_,type:"POST",dataType:"json",success:function(l){l.success===!0?window.location.reload():alert(l.data.message)}}),!1},update_extended_cover_offer:function(){var t=e(this),i="0",a=e(this).closest(".mfb-available-offers").find("select.offer-selector").find("option:selected").data("offer_id");e(this).is(":checked")&&(i="1");var r={action:"mfb_update_extended_cover_offer",offer_id:a,with_extended_cover:i};return e.ajax({url:mfb_js_resources.ajax_url,data:r,type:"POST",dataType:"json",success:function(s){s.success=="true"&&(jQuery.trim(s.new_label)?t.closest(".mfb-available-offers").find(".extended-cover-cost").text(mfb_js_resources.eclc+" "+s.new_label):t.closest(".mfb-available-offers").find(".extended-cover-cost").text(""))}}),!1},update_selected_offer:function(){var t=e(this).find("option:selected").data("offer_id"),i={action:"mfb_update_selected_offer",offer_id:t,shipment_id:e(this).closest("tr").data("shipment_id")};return e.ajax({url:mfb_js_resources.ajax_url,data:i,type:"POST",dataType:"json",success:function(a){window.location.reload()}}),!1},delete_shipment:function(){var t={action:"mfb_delete_shipment",shipment_id:e(this).closest("tr").data("shipment_id")};return e.ajax({url:mfb_js_resources.ajax_url,data:t,type:"POST",success:function(i){window.location.reload()}}),!1},add_return_shipment:function(){var t={action:"mfb_create_return_shipment",shipment_id:e(this).closest("tr").data("shipment_id")};return e.ajax({url:mfb_js_resources.ajax_url,data:t,type:"POST",success:function(i){window.location.reload()}}),!1},load_recipient_form:function(t){t.preventDefault(),e(this).closest("div.display_recipient_address").hide(),e(this).closest("td").find("div.recipient_form_container").show()},load_shipper_form:function(t){t.preventDefault(),e(this).closest("div.display_shipper_address").hide(),e(this).closest("td").find("div.shipper_form_container").show()},load_parcel_form:function(t){t.preventDefault(),e(this).closest("div.parcel-data").hide(),e(this).closest("div.parcel").find("div.parcel-form").show()},hide_recipient_form:function(t){t.preventDefault(),e(this).closest("td").find("div.recipient_form_container").hide(),e(this).closest("td").find("div.display_recipient_address").show()},hide_shipper_form:function(t){t.preventDefault(),e(this).closest("td").find("div.shipper_form_container").hide(),e(this).closest("td").find("div.display_shipper_address").show()},hide_parcel_form:function(t){t.preventDefault(),e(this).closest("div.parcel").find("div.parcel-form").hide(),e(this).closest("div.parcel").find("div.parcel-data").show()},submit_recipient_form:function(t){t.preventDefault();var i="mfb_update_recipient",a=e(this).closest("tr").data("shipment_id");return e(this).find(".spinner").addClass("is-active"),e.ajax({url:mfb_js_resources.ajax_url,data:e(this).closest("div.recipient_form_container").find("input, textarea, select").serialize()+"&action="+i+"&shipment_id="+a,type:"POST",success:function(r){window.location.reload()}}),!1},submit_shipper_form:function(t){t.preventDefault();var i="mfb_update_shipper",a=e(this).closest("tr").data("shipment_id");return e(this).find(".spinner").addClass("is-active"),e.ajax({url:mfb_js_resources.ajax_url,data:e(this).closest("div.shipper_form_container").find("input, textarea, select").serialize()+"&action="+i+"&shipment_id="+a,type:"POST",success:function(r){window.location.reload()}}),!1},submit_parcel_form:function(t){t.preventDefault();var i="mfb_update_parcel",a=e(this).closest("tr").data("shipment_id"),r=e(this).closest("div.parcel").data("parcel_index");return e(this).find(".spinner").addClass("is-active"),e.ajax({url:mfb_js_resources.ajax_url,data:e(this).closest("div.parcel-form").find("input, select").serialize()+"&action="+i+"&shipment_id="+a+"&parcel_index="+r,type:"POST",success:function(s){window.location.reload()}}),!1},delete_parcel:function(t){t.preventDefault();var i="mfb_delete_parcel",a=e(this).closest("tr").data("shipment_id"),r=e(this).closest("div.parcel").data("parcel_index");return e(this).closest("div.parcel").find(".spinner.delete-parcel-spinner").addClass("is-active"),e.ajax({url:mfb_js_resources.ajax_url,data:"action="+i+"&shipment_id="+a+"&parcel_index="+r,type:"POST",success:function(s){window.location.reload()}}),!1},download_labels:function(){var t=e(this).closest("tr").data("shipment_id");return window.open(mfb_js_resources.labels_url+"&shipment_id="+t),!1},trackthisExpedition:function(){var t=e("#post_ID").attr("value"),i=e(this).data("offer_id"),a=e(this),r={action:"mfb_check_status",offer_id:i,wc_order_id:t};return e.ajax({url:mfb_js_resources.ajax_url,data:r,type:"POST",success:function(s){if(s.success=="true"){var o=s.status;a.closest(".shipment").find(".last-status").html(o),s.all_delivered&&s.all_delivered==!0&&window.location.reload()}else a.closest(".shipment").find(".last-status").text("")}}),!1},trackthis:function(){var t=e(this).data("order_id"),i=e(this),a=e(this).data("api_uuid"),r={action:"mfb_check_status",apiuid:a,wc_order_id:t,lang:mfb_js_resources.lang};return e.ajax({url:mfb_js_resources.ajax_url,data:r,type:"POST",success:function(s){if(s.success=="true"){var o=s.status;i.closest(".woocommerce-order-data").find("#last-status").html(o)}else i.closest(".woocommerce-order-data").find("#last-status").text("")}}),!1}};f.init()});
